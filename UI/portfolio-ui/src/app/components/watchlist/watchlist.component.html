<div class="p-2 rounded shadow h-[300px]">
    <div class="flex overflow-y-auto">
        <h3 class="text-sm font-semibold mb-2 text-blue-600">Watchlist</h3>
        <button
        (click)="openEdit()"
        class="bg-blue-600 text-white rounded text-xs px-2 mb-2 ml-2 py-1 rounded "
      >
        Edit
      </button>
    </div>
  
  
  <div class="overflow-y-auto max-h-[200px] mb-4 -mt-1">
          <table class="min-w-full border border-blue-200 text-sm rounded-lg overflow-hidden">
        <thead class="bg-gray-100 sticky top-0 z-10">
          <tr>
            <th class="px-4 py-2 text-left">Symbol</th>
            <th class="px-4 py-2 text-left">Price</th>
            <th class="px-4 py-2 text-left">High</th>
            <th class="px-4 py-2 text-left">Low</th>
            <th class="px-4 py-2 text-left">Open</th>
            <th class="px-4 py-2 text-left">Prev Close</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let stock of watchlist" class="border-t cursor-pointer hover:bg-gray-50" (click)="showNews(stock.symbol)">
            <td class="px-4 py-2 font-medium">
                <div class="flex flex-col">
                    <span class="font-medium">{{ stock.symbol }}</span>
                    <span class="text-xs text-gray-500">{{ stock.name }}</span>
                </div>
            </td>
            <td class="px-4 py-2">${{ stock.current_price | number: '1.2-2'}}</td>
            <td class="px-4 py-2">${{ stock.high | number: '1.2-2'}}</td>
            <td class="px-4 py-2">${{ stock.low | number: '1.2-2'}}</td>
            <td class="px-4 py-2">${{ stock.open | number: '1.2-2'}}</td>
            <td class="px-4 py-2">${{ stock.previousClose | number: '1.2-2'}}</td>
          </tr>
        </tbody>
      </table>
  </div>
      
  </div>

  <!-- Modal -->
<div
class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
*ngIf="editModal"
>
<div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full relative">
  <h3 class="text-lg font-semibold mb-4">Edit Watchlist</h3>

  <ul class="h-[200px] border rounded mb-4 overflow-y-auto">
          <li
        *ngFor="let stock of watchlist"
        class="flex justify-between items-center border-b border-blue-200 py-1 pl-1 pr-1"
      >
      <span>  <div class="flex flex-col">
        <span class="font-medium">{{ stock.symbol }}</span>
        <span class="text-xs text-gray-500">{{ stock.name }}</span>
      </div></span>
      <button
        (click)="removeSymbol(stock.symbol)"
        class="text-red-500 hover:text-red-700 text-sm"
      >
        Remove
      </button>
    </li>
  </ul>

  <div class="flex items-center mb-4 space-x-2">
    <div class="flex-column items-center w-full">
        <input type="text" placeholder="Search for a stock..." 
        class="w-full px-3 py-2 border border-gray-300 rounded text-sm" 
        [(ngModel)]="newSymbol"
        (keyup)="onSearchChange()"
        (keyup.enter)="searchStock()"
        />
        <div *ngIf="searchResults.length > 0" class="absolute z-10 w-full bg-white border border-gray-300 rounded mt-1 max-h-60 overflow-y-auto">
            <ul class="divide-y divide-blue-200">
              <li *ngFor="let stock of searchResults" (click)="selectStock(stock)" class="p-2 hover:bg-gray-100 cursor-pointer">
                <div class="flex justify-between items-start">
                  <div class="flex-1">
                    <div class="font-semibold">{{ stock.symbol }}</div>
                    <div class="text-sm text-gray-600">{{ stock.name }}</div>
                    <div class="text-xs text-gray-500">{{ stock.exchange }} â€¢ {{ stock.type }}</div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        <div *ngIf="searchError" class="text-sm text-red-600 mb-2">
        Stock not found. Please try again.
        </div>
        <div *ngIf="current_stock" class="w-full p-3 mb-4 rounded bg-white border shadow text-sm">
            <div>
                <span class="font-semibold">{{ current_stock.symbol }}</span>
                <div *ngIf="current_stock.name" class="text-xs text-gray-600">{{ current_stock.name }}</div>
              </div>
        </div>
    </div>
    <button
      (click)="addSymbol()"
      class="flex justify-center bg-blue-600 text-white px-3 py-1 rounded text-sm"
    >
      Add
    </button>
  </div>

  <button
    (click)="closeEdit()"
    class="absolute top-2 right-2 text-gray-500 hover:text-black text-xl"
  >
    &times;
  </button>
</div>
</div>

<!-- News Modal -->
<div
  class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
  *ngIf="newsModalVisible"
  (click)="hideNews()"
>
  <div 
    class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto"
    (click)="$event.stopPropagation()"
  >
    <div class="flex justify-between items-start mb-4">
      <div>
        <h3 class="text-lg font-semibold text-gray-800">News for {{ selectedSymbol }}</h3>
        <p class="text-sm text-gray-600">Latest news and updates</p>
      </div>
      <button 
        (click)="hideNews()"
        class="text-gray-400 hover:text-gray-600"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div class="space-y-4">
      <div *ngIf="isLoadingNews" class="flex justify-center items-center py-8">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <span class="ml-2 text-gray-600">Loading news...</span>
      </div>
      
      <div *ngIf="!isLoadingNews && newsData?.articles?.length === 0" class="text-center py-8 text-gray-500">
        <span>No news available for {{ selectedSymbol }}</span>
      </div>
      
      <div *ngIf="!isLoadingNews && newsData?.error" class="text-center py-8 text-red-500">
        <span>Error loading news: {{ newsData.error }}</span>
      </div>
      
      <div *ngIf="!isLoadingNews && newsData?.articles?.length > 0" class="space-y-4">
        <div *ngFor="let article of newsData.articles" class="border-b border-gray-200 pb-4 last:border-b-0">
          <div class="flex justify-between items-start mb-2">
            <h4 class="font-semibold text-gray-800 text-sm leading-tight">
              <a [href]="article.link" target="_blank" class="hover:text-blue-600">
                {{ article.title }}
              </a>
            </h4>
          </div>
          <p class="text-xs text-gray-600 mb-2 line-clamp-3">{{ article.summary }}</p>
          <div class="flex justify-between items-center text-xs text-gray-500">
            <span>{{ article.publisher }}</span>
            <span>{{ formatDate(article.published) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
